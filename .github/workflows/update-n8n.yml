name: Check for n8n Updates and Sync to Hugging Face Space

on:
  schedule:
    - cron: '0 18 * * 5' # Every Friday at 18:00 UTC
  workflow_dispatch:

jobs:
  rebuild-space:
    runs-on: ubuntu-latest
    steps:
      - name: Restart Hugging Face Space to pull latest image
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          HF_REPO: ${{ vars.HF_REPO }}
        run: |
          if [ -z "$HF_REPO" ]; then
            echo "::error::HF_REPO is not set"
            exit 1
          fi
          echo "Triggering Factory Reboot for $HF_REPO to pull latest docker image..."
          # Factory reboot forces a complete rebuild of the container, pulling the latest layers
          curl -X POST "https://huggingface.co/api/spaces/$HF_REPO/restart?factory=true" \
               -H "Authorization: Bearer $HF_TOKEN" \
               -v
